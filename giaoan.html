<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>C·∫≠p nh·∫≠t gi√°o √°n</title>
<link rel="stylesheet" href="css/giaoan.css">
</head>
<body>
<a href="teaching.html" class="back">&lt;- V·ªÅ trang d·∫°y</a>
<h1>C·∫¨P NH·∫¨T GI√ÅO √ÅN</h1>

<div class="formRow">

  <label>ID gi√°o vi√™n:</label>
  <input type="text" id="gvIDInput" placeholder="Nh·∫≠p ID gi√°o vi√™n">
  <span id="gvNameDisplay"></span>
</div>

<div class="formRow">
  <label>M√¥n h·ªçc:</label>
  <select id="subjectSelect"></select>
</div>

<div class="formRow">
  <label>T√™n b√†i gi·∫£ng:</label>
  <input type="text" id="lessonName">
</div>

<div class="formRow">
  <label>S·ªë ti·∫øt:</label>
  <input type="text" id="lessonHours">
</div>

<div class="formRow">
  <label>Ng√†y b·∫Øt ƒë·∫ßu:</label>
  <input type="date" id="lessonDate">
</div>

<div class="editorToolbar">
  <button type="button" id="btnChooseFile">üìÅ Choose File</button>
  <input type="file" id="fileInput" accept="image/*" hidden>

    <button type="button" onclick="addAudio()">üîä Audio</button>
  <button type="button" id="btnMp4">üé¨ MP4 (GG)</button>
  <button type="button" onclick="addYT()">üé¨ YouTube</button>
  <button type="button" onclick="addPPT()">üìä Powepoint + PDF</button>
  <button type="button" onclick="openPreview()">üëÅ Preview</button>
</div>




  <div
 id="lessonContent"
  contenteditable="true"
  style="border:1px solid #333; min-height:200px; padding:8px; overflow:auto;"
  placeholder="Nh·∫≠p n·ªôi dung b√†i gi·∫£ng t·∫°i ƒë√¢y..."
></div>


  <!-- PREVIEW -->
  <div id="lessonPreview" style="display:none; margin-top:10px;
       padding:10px; border:1px solid #ccc; background:#fafafa">
  </div>





<div class="formActions">
  <button id="addLesson" type="button">Th√™m</button>
  <button id="saveLesson" type="button">L∆∞u</button>

 
  <button id="goBaitap">B√†i T·∫≠p</button>
</div>

<h2>Danh s√°ch gi√°o √°n theo m√¥n h·ªçc</h2>
<div id="lessonList"></div>
<script>
/* ================================
   INSERT HTML AT CURSOR (CONTENTEDITABLE)
================================ */
function insertAtCursor(html) {
  const sel = window.getSelection();
  if (!sel || !sel.rangeCount) return;

  const range = sel.getRangeAt(0);
  range.deleteContents();

  const wrapper = document.createElement("div");
  wrapper.innerHTML = html;

  const frag = document.createDocumentFragment();
  let node, lastNode;
  while ((node = wrapper.firstChild)) {
    lastNode = frag.appendChild(node);
  }

  range.insertNode(frag);

  if (lastNode) {
    range.setStartAfter(lastNode);
    range.collapse(true);
    sel.removeAllRanges();
    sel.addRange(range);
  }

  document.getElementById("lessonContent").focus();
}

/* ================================
   ADD IMAGE
================================ */
function addImage() {
  const url = prompt("D√°n link ·∫£nh:");
  if (!url) return;

  insertAtCursor(`<img src="${url}" style="max-width:100%;"><br>`);
}

/* ================================
   ADD AUDIO / YOUTUBE AUDIO
================================ */
function addAudio() {
  const url = prompt("D√°n link MP3 ho·∫∑c YouTube:");
  if (!url) return;

  if (url.includes("youtube")) {
    const id = url.includes("watch?v=")
      ? url.split("watch?v=")[1].split("&")[0]
      : url.split("youtu.be/")[1];

    insertAtCursor(`
      <iframe
        width="100%"
        height="80"
        src="https://www.youtube.com/embed/${id}"
        allowfullscreen>
      </iframe><br>
    `);
  } else {
    insertAtCursor(`<audio controls src="${url}"></audio><br>`);
  }
}

/* ================================
   ADD YOUTUBE VIDEO
================================ */
function addYT() {
  const url = prompt("D√°n link YouTube:");
  if (!url) return;

  const id = url.includes("watch?v=")
    ? url.split("watch?v=")[1].split("&")[0]
    : url.split("youtu.be/")[1];

  insertAtCursor(`
    <iframe
      width="100%"
      height="315"
      src="https://www.youtube.com/embed/${id}"
      allowfullscreen>
    </iframe><br>
  `);
}
/* ================================
   ADD GOOGLE SLIDES / DRIVE (PPT, PDF)
================================ */
function addPPT() {
  const editor = document.getElementById("lessonContent");
  editor.focus();

  const url = prompt("D√°n link Google Slides ho·∫∑c Google Drive:");
  if (!url) return;

  let iframe = "";

  // ===== GOOGLE SLIDES =====
  if (url.includes("docs.google.com/presentation")) {
    const m = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
    if (!m) {
      alert("‚ùå Link Slides kh√¥ng h·ª£p l·ªá");
      return;
    }
    const id = m[1];

    iframe = `
      <iframe
        src="https://docs.google.com/presentation/d/${id}/preview"
        style="width:100%; height:600px; border:none;"
        allowfullscreen>
      </iframe><br>
    `;
  }

  // ===== GOOGLE DRIVE FILE =====
  else if (url.includes("drive.google.com/file")) {
    const m = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
    if (!m) {
      alert("‚ùå Link Drive kh√¥ng h·ª£p l·ªá");
      return;
    }
    const id = m[1];

    // d√πng Google Docs Viewer ‚Üí kh√¥ng l·ªói 500
    const fileUrl = `https://drive.google.com/uc?id=${id}&export=download`;

    iframe = `
      <iframe
        src="https://docs.google.com/gview?url=${encodeURIComponent(fileUrl)}&embedded=true"
        style="width:100%; height:600px; border:none;">
      </iframe><br>
    `;
  }

  else {
    alert("‚ùå Kh√¥ng ph·∫£i link Google Slides ho·∫∑c Google Drive");
    return;
  }

  insertAtCursor(iframe);
}

</script>


<script>
  // N√∫t "B√†i T·∫≠p" d·∫´n v·ªÅ trang baitap.html
  document.getElementById("goBaitap").addEventListener("click", () => {
    window.location.href = "baitap.html";
  });
</script>

<script type="module" src="js/giaoan.js"></script>
</body>
</html>
